#+TITLE: Orbit

* Dependencies
:PROPERTIES:
:CUSTOM_ID: Dependencies-8z0lq561t7k0
:END:

#+BEGIN_SRC shell
  # Web server dependencies.
  pip install jinja2 quart

  # Web scraper dependencies.
  pip install beautifulsoup4 grequests dataclasses-json

  # ML
  pip install sentence-transformers nltk

  # Database dependencies.
  pip install redis[hiredis]
#+END_SRC

* Architecture
:PROPERTIES:
:CUSTOM_ID: Architecture-0c2lq561t7k0
:END:

#+BEGIN_SRC dot :file architecture.png
digraph {
  node[shape=record];
  label="Dataflow";
  subgraph cluster_0 {
    label="Orbit"
    redis -> scraper[style=invis];
    redis -> ranking -> search_endpoint;
    scraper -> redis[label="Upload links."];
    redis -> indexer;
    indexer -> redis[label="Precompute embeddings\n+ other stuff"];
    redis[shape=cylinder];
    ranking[label="ranking.py"];
  }
  search_endpoint -> user;
}
#+END_SRC

#+RESULTS:
[[file:architecture.png]]

- Paper Pete populates Index regularly.
- Orbit hosts the frontent. It serves results by utilizing the index.

** Index
:PROPERTIES:
:CUSTOM_ID: ArchitectureIndex-8ujah961t7k0
:END:

The Index is a key/value store hosted on Redis. The following scheme
is used:

- ~url:<url> -> <document>~ - Maps a URL to its document in json format.

A document contains the following fields:

- ~url~ - The URL of the document.
- ~title~ - The title of the document.
- ~date~ - The date of the document.
- ~terms~ - A list of strings containing the terms in the title. The
  terms are lowercased and lemmatized by using the [[https://www.nltk.org/][NLTK]] library. For
  example, "documents" becomes "document" and "running" becomes "run".
- ~title_embedding~ - A 384 dimensional float vector that captures the
  semantic meaning of the title. This is generated by using the
  [[https://huggingface.co/sentence-transformers/all-MiniLM-L6-v2][all-MiniLM-L6-v2 model]].
